<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1, p {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }
        .info-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e0e0e0; }
        .info-row:last-child { border-bottom: none; }
        .label { font-weight: 600; color: #555; }
        .value { color: #667eea; font-weight: 500; }
        .status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        .status.online { background: #d4edda; color: #155724; }
        .status.offline { background: #f8d7da; color: #721c24; }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:active { transform: translateY(0); }
        .speed-meter {
            margin-top: 20px;
            text-align: center;
        }
        .speed-avg {
            font-size: 40px;
            font-weight: 700;
            color: #667eea;
        }
        .rtt-avg {
            font-size: 22px;
            color: #ffab26;
            font-weight: 600;
            margin-top: 5px;
        }
        .speed-unit { font-size: 18px; color: #888; }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        #speedChart {
            margin: 0 auto;
            display: block;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(102,126,234,0.06);
        }
        .average-info {
            margin-top: 10px;
            text-align: center;
            font-size: 18px;
            color: #333;
        }
        .average-info span {
            margin: 0 12px;
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõú WiFi –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ by Andrew Berlin</h1>
        <p>@Berlandbor</p> <br>
        <div class="info-card">
            <div class="info-row">
                <span class="label">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</span>
                <span class="status online" id="connectionStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="info-row">
                <span class="label">–¢–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</span>
                <span class="value" id="connectionType">-</span>
            </div>
            <div class="info-row">
                <span class="label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø:</span>
                <span class="value" id="effectiveType">-</span>
            </div>
            <div class="info-row">
                <span class="label">–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏:</span>
                <span class="value" id="downlink">-</span>
            </div>
            <div class="info-row">
                <span class="label">RTT (–∑–∞–¥–µ—Ä–∂–∫–∞):</span>
                <span class="value" id="rtt">-</span>
            </div>
            <div class="info-row">
                <span class="label">–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞:</span>
                <span class="value" id="saveData">-</span>
            </div>
        </div>
        <div class="speed-meter">
            <div class="speed-avg"><span id="speedAvgDisplay">-</span> <span class="speed-unit">Mbps</span></div>
            <div class="rtt-avg">–ó–∞–¥–µ—Ä–∂–∫–∞: <span id="rttAvgDisplay">-</span> –º—Å</div>
        </div>
        <button onclick="runSpeedTest(event)">üöÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å</button>
        <div style="margin-top: 30px; text-align:center;">
            <canvas id="speedChart" width="400" height="200"></canvas>
            <div class="average-info">
                –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: <span id="avgSpeed">-</span> Mbps |
                –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞: <span id="avgRtt">-</span> –º—Å
            </div>
        </div>
        <div class="warning" id="warning" style="display: none;"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Network Information API
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        function updateNetworkInfo() {
            const statusEl = document.getElementById('connectionStatus');
            if (navigator.onLine) {
                statusEl.textContent = '–û–Ω–ª–∞–π–Ω';
                statusEl.className = 'status online';
            } else {
                statusEl.textContent = '–û—Ñ–ª–∞–π–Ω';
                statusEl.className = 'status offline';
            }
            if (connection) {
                document.getElementById('connectionType').textContent = connection.type || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('effectiveType').textContent = connection.effectiveType || '-';
                document.getElementById('rtt').textContent = connection.rtt ? connection.rtt + ' –º—Å' : '-';
                document.getElementById('saveData').textContent = connection.saveData ? '–í–∫–ª—é—á–µ–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞';
                showWarnings();
            } else {
                document.getElementById('warning').style.display = 'block';
                document.getElementById('warning').textContent = '‚ö†Ô∏è Network Information API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome/Edge.';
            }
        }
        function showWarnings() {
            const warningEl = document.getElementById('warning');
            let warnings = [];
            if (connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g')) {
                warnings.push('‚ö†Ô∏è –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
            }
            if (connection && connection.rtt > 500) {
                warnings.push('‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (RTT > 500ms)');
            }
            if (connection && connection.downlink < 1) {
                warnings.push('‚ö†Ô∏è –ù–∏–∑–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏');
            }
            if (warnings.length > 0) {
                warningEl.style.display = 'block';
                warningEl.innerHTML = warnings.join('<br>');
            } else {
                warningEl.style.display = 'none';
            }
        }

        // Chart.js –¥–∞–Ω–Ω—ã–µ
        let speedData = {
            labels: [],
            datasets: [
                {
                    label: '–°–∫–æ—Ä–æ—Å—Ç—å (Mbps)',
                    data: [],
                    backgroundColor: 'rgba(102, 126, 234, 0.18)',
                    borderColor: '#667eea',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    yAxisID: 'y-speed'
                },
                {
                    label: 'RTT (–º—Å)',
                    data: [],
                    backgroundColor: 'rgba(255,171,38,0.12)',
                    borderColor: '#ffab26',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y-rtt'
                }
            ]
        };
        let speedChart;
        window.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('speedChart').getContext('2d');
            speedChart = new Chart(ctx, {
                type: 'line',
                data: speedData,
                options: {
                    responsive: false,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        x: { title: { display: true, text: '–í—Ä–µ–º—è' } },
                        'y-speed': {
                            title: { display: true, text: 'Mbps' },
                            position: 'left',
                            min: 0
                        },
                        'y-rtt': {
                            title: { display: true, text: '–ó–∞–¥–µ—Ä–∂–∫–∞, –º—Å' },
                            position: 'right',
                            min: 0,
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        });

        function updateAverages() {
            // –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å
            const speedArr = speedData.datasets[0].data;
            const avgSpeed = speedArr.length ? (speedArr.reduce((s, a) => s + a, 0) / speedArr.length).toFixed(2) : "-";
            document.getElementById('avgSpeed').textContent = avgSpeed;
            document.getElementById('speedAvgDisplay').textContent = avgSpeed;
            document.getElementById('downlink').textContent = avgSpeed === "-" ? "-" : (avgSpeed + " Mbps");

            // –°—Ä–µ–¥–Ω–∏–π RTT
            const rttArr = speedData.datasets[1].data.filter(a => typeof a === "number" && !isNaN(a));
            const avgRtt = rttArr.length ? (rttArr.reduce((s, a) => s + a, 0) / rttArr.length).toFixed(0) : "-";
            document.getElementById('avgRtt').textContent = avgRtt;
            document.getElementById('rttAvgDisplay').textContent = avgRtt;
        }

        // –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ + RTT (–∑–∞–¥–µ—Ä–∂–∫–∏)
        async function runSpeedTest(event = null, auto = false) {
            let button;
            if (event) {
                button = event.target;
                button.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
                button.disabled = true;
            }
            try {
                // –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
                const fileUrl = 'https://raw.githubusercontent.com/github/explore/main/topics/javascript/javascript.png';
                const fileSizeInBytes = 50000;
                const startTime = new Date().getTime();
                const response = await fetch(fileUrl + '?cacheBust=' + startTime);
                await response.blob();
                const endTime = new Date().getTime();
                const duration = (endTime - startTime) / 1000;
                const speedMbps = ((fileSizeInBytes * 8) / (duration * 1024 * 1024)).toFixed(2);

                // RTT –∏–∑–º–µ—Ä—è–µ–º –ø–∏–Ω–≥–æ–º (–ª–∏–±–æ –±–µ—Ä–µ–º –∏–∑ API)
                let rtt = "-";
                if (connection && typeof connection.rtt === "number") {
                    rtt = connection.rtt;
                } else {
                    try {
                        const rttStart = performance.now();
                        await fetch("https://www.google.com/images/branding/googlelogo/1x/googlelogo_light_color_92x30dp.png?cacheBust=" + Date.now(), { mode: 'no-cors' });
                        rtt = Math.round(performance.now() - rttStart);
                    } catch (e) { rtt = "-"; }
                }

                // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É –Ω–∞ –≥—Ä–∞—Ñ–∏–∫
                const date = new Date();
                speedData.labels.push(date.toLocaleTimeString());
                speedData.datasets[0].data.push(Number(speedMbps));
                speedData.datasets[1].data.push(isNaN(rtt) || rtt === "-" ? null : Number(rtt));
                if (speedChart) speedChart.update();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                updateAverages();
            } catch (error) {
                if (!auto) alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏: ' + error.message);
            } finally {
                if (button) {
                    button.textContent = 'üöÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å';
                    button.disabled = false;
                }
            }
        }

        updateNetworkInfo();
        if (connection) {
            connection.addEventListener('change', updateNetworkInfo);
        }
        window.addEventListener('online', updateNetworkInfo);
        window.addEventListener('offline', updateNetworkInfo);
        setInterval(updateNetworkInfo, 5000);

        setInterval(() => runSpeedTest(null, true), 10000);
        runSpeedTest(null, true);
    </script>
</body>
</html>